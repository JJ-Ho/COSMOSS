function hF = PlotXYZfiles_AmideI(SData,GUI_Inputs)
%% PlotXYZfiles
%  
% Given the Stuctural infomation that generated by GetAmideI.m this
% function can plot the molecule and its' amide I modes.
% 
% ------- Version log -----------------------------------------------------
% 
% Ver. 1.4  140605  Readuce the process for reading XYZ data
% 
% Ver. 1.3  131107  Add imput "Rot_Mat" to rotate molecue as user assigned
%                   This is the correction follow by v1.2 of
%                   OneDSFG_AmideI.m
% 
% Ver. 1.2  130930  Move gplot3 from Molecular_Plot to here to accomodate
%                   the update of molecular_plot
% 
% Ver. 1.1  130814  Bug in atom position index fixed 
% 
% Ver. 1.0  130729  Isolated from TwoDSFG_Simulation
% 
% ------------------------------------------------------------------------
% Copyright Jia-Jung Ho, 2013

%% Debug

% PDB_Data    = ConstructGrid('Debug');
% PDB_Data = TwoMolConstruct;
% Orientation = [0,0,0];

%% Input parser
GUI_Inputs_C      = fieldnames(GUI_Inputs);
GUI_Inputs_C(:,2) = struct2cell(GUI_Inputs);
GUI_Inputs_C      = GUI_Inputs_C';

INPUT = inputParser;
INPUT.KeepUnmatched = 1;

% Default values
defaultPlot_Atoms     = 1;
defaultPlot_Bonds     = 1;
defaultPlot_Axis      = 1;
defaultPlot_SideChain = 0;

% Add optional inputs to inputparser object
addOptional(INPUT,'Plot_Atoms'     ,defaultPlot_Atoms);
addOptional(INPUT,'Plot_Bonds'     ,defaultPlot_Bonds);
addOptional(INPUT,'Plot_Axis'      ,defaultPlot_Axis);
addOptional(INPUT,'Plot_SideChain' ,defaultPlot_SideChain);

parse(INPUT,GUI_Inputs_C{:});

Plot_Atoms     = INPUT.Results.Plot_Atoms;
Plot_Bonds     = INPUT.Results.Plot_Bonds;
Plot_Axis      = INPUT.Results.Plot_Axis;
Plot_SideChain = INPUT.Results.Plot_SideChain;

%% Main
XYZ      = SData.XYZ;
AtomName = SData.AtomName;
Center   = SData.LocCenter;
COM      = SData.COM;

%% Position info
C_Ind = strcmp(AtomName,'C');
O_Ind = strcmp(AtomName,'O');
N_Ind = strcmp(AtomName,'N');
BB_Ind = or(or(C_Ind,O_Ind),N_Ind);

hF = figure; 
hold on

    %% draw bonds
    if Plot_Bonds
        if Plot_SideChain
            XYZ_bond = XYZ;
            Atom_bond = AtomName;
        else
            XYZ_bond = XYZ(BB_Ind,:);
            Atom_bond = AtomName(BB_Ind);
        end
        
        Conn = Connectivity(Atom_bond,XYZ_bond);
        gplot3(Conn,XYZ_bond);
    end
    
    %% Draw atoms
    if Plot_Atoms
        plot3(Center(:,1)  ,Center(:,2)  ,Center(:,3)  ,'LineStyle','none','Marker','d','MarkerFaceColor','w')

        plot3(XYZ(C_Ind,1),XYZ(C_Ind,2),XYZ(C_Ind,3),'LineStyle','none','Marker','o','MarkerFaceColor',[0,0,0],'MarkerSize',10)
        plot3(XYZ(O_Ind,1),XYZ(O_Ind,2),XYZ(O_Ind,3),'LineStyle','none','Marker','o','MarkerFaceColor',[1,0,0],'MarkerSize',10)
        plot3(XYZ(N_Ind,1),XYZ(N_Ind,2),XYZ(N_Ind,3),'LineStyle','none','Marker','o','MarkerFaceColor',[0,0,1],'MarkerSize',10)        
    end
    
    %% Draw molecular and Lab frame
    if Plot_Axis
        hAx = findobj(hF,'type','axes');
        Lab_Frame = [1,0,0;
                     0,1,0;
                     0,0,1 ];
        
        PlotRotMolFrame(hAx,Lab_Frame,Lab_Frame,COM)
    end
    
    %% Draw labeled atoms
    Plot_Label = 1;
    if Plot_Label
        L_Index = GUI_Inputs.L_Index;
        L_C = Center(L_Index,:);
        plot3(L_C(:,1),L_C(:,2),L_C(:,3),'LineStyle','none','Marker','o','MarkerFaceColor','g','MarkerSize',11)
    end
hold off

%% figure setting
xlabel('X')
ylabel('Y')
axis image;
rotate3d on